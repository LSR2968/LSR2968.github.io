clusterprofiler
================
lsr
2022-08-31

## RNA下游富集分析

RNA富集分析包括使用GSEA本地版的富集分析和使用clusterprofiler包的R语言富集分析，鉴于本地版的GSEA需要文件格式较为复杂，本文仅描述使用profiler包的富集分析方法。

### profiler包富集方法

1.  使用Deseq2寻找差异基因

``` r
library(tidyverse)
library(DESeq2)
gene_reads <- read_csv('../rawdata/pathway/Merge_gene_read.csv')%>% 
  distinct(Description,.keep_all = T) %>% #去重
  column_to_rownames('Description')   #将基因名变为列名
```

``` r
head(gene_read)
```

    ##             G5T G9T G20T G27T G30T G31T G32T G33T G34T G36T G37T G38T G39T G41T G42T G43T G44T
    ## DDX11L1       0   2    0    1    5    0    0    0    0    8    5   12    2    0    2    0    7
    ## WASH7P      977 849  637 1058 1629 1271  630 1304 1150  949 1151 1482  934  691  991  858 1582
    ## MIR1302-2HG   4   0    1    2    0    0    0    0    5    2    0    4    4    4    1    4    3
    ## FAM138A       0   0    0    0    0    0    1    0    0    0    0    0    0    0    0    0    0
    ## OR4G4P        0   0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0
    ## OR4G11P       0   0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0

``` r
#将表达矩阵整理为列为样本，行为基因的数据格式
```

``` r
group_ox <- read_csv('./OX.csv') %>% 
  column_to_rownames('sample')
```

``` r
head(group_ox)
```

    ##      group
    ## G5T    Low
    ## G9T    Low
    ## G20T   Low
    ## G27T   Low
    ## G30T   Low
    ## G31T   Low

``` r
#将分组矩阵整理为列为分组，行为样本的格式，注意样本顺序和表达矩阵一致
```

``` r
#寻找差异基因
dds_ox <- DESeqDataSetFromMatrix(gene_read,
                                  group_ox,
                                  design = ~group)
dds_ox <- DESeq(dds_ox)
res_ox <- results(dds_ox)
diff_gene_deseq2_ox <- as.data.frame(subset(res_ox,padj<0.05 & abs(log2FoldChange)>=1))
```

``` r
print(diff_gene_deseq2_ox)
```

    ##                baseMean log2FoldChange     lfcSE      stat       pvalue         padj
    ## TNFRSF25     641.281724       1.580816 0.4293093  3.682232 2.312011e-04 3.420898e-02
    ## PLA2G2A      254.227096       5.573330 1.3788825  4.041918 5.301573e-05 1.264696e-02
    ## AL033527.5    14.777609       6.014332 1.6755067  3.589560 3.312366e-04 4.476097e-02
    ## EDN2          43.587071      -3.373104 0.8816746 -3.825792 1.303521e-04 2.362303e-02
    ## GFI1          97.181864       3.226123 0.8932712  3.611583 3.043341e-04 4.160657e-02
    ## HMGCS2       712.703354       3.749948 1.0158047  3.691603 2.228452e-04 3.360367e-02
    ## PDZK1        172.147029       5.005291 1.1638702  4.300558 1.703684e-05 5.689817e-03
    ## AL353807.5   193.839371       2.914872 0.7814904  3.729889 1.915645e-04 3.067393e-02
    ## AL365181.2   414.257254       2.945528 0.7180319  4.102225 4.091967e-05 1.051231e-02
    ## IGSF9       1755.956276       3.062926 0.7786275  3.933749 8.363101e-05 1.725018e-02
    ## GPA33        181.947141       6.126634 1.3423087  4.564251 5.012810e-06 2.211122e-03
    ## TDRD5         40.884493       3.952215 0.9894733  3.994262 6.489614e-05 1.472953e-02
    ## PROX1-AS1     81.490238       6.038071 1.6061193  3.759416 1.703104e-04 2.823771e-02
    ## PROX1        500.293328       2.634397 0.7145812  3.686630 2.272432e-04 3.383752e-02
    ## RHOU        2039.781142       1.392713 0.3073198  4.531803 5.848224e-06 2.531848e-03
    ## RYR2          12.089775       4.546631 1.1812802  3.848901 1.186488e-04 2.201406e-02
    ## SRD5A2        24.220971       4.820008 1.3328638  3.616280 2.988676e-04 4.109957e-02
    ## STPG4         52.435889       4.875752 1.2421588  3.925225 8.664886e-05 1.731348e-02
    ## EMX1         132.744018       5.728113 1.1126298  5.148265 2.629063e-07 1.862492e-04
    ## EGR4          37.333429       5.905802 1.4748137  4.004439 6.216478e-05 1.438899e-02
    ## TLX2          38.630426       3.222415 0.8899984  3.620697 2.938103e-04 4.088510e-02
    ## DQX1         435.391373       3.170906 0.8046862  3.940550 8.129491e-05 1.696886e-02
    ## TRABD2A      500.423653       3.857184 0.9150325  4.215352 2.493888e-05 7.773615e-03
    ## MYO7B       1976.381575      10.038780 2.3129982  4.340159 1.423796e-05 4.967985e-03
    ## ARHGEF4       96.528859       3.713390 1.0112454  3.672095 2.405698e-04 3.501749e-02
    ## COL5A2       125.547572       1.547094 0.3821518  4.048375 5.157452e-05 1.242999e-02
    ## UGT1A8        16.003787      21.400065 3.1329020  6.830748 8.447280e-12 1.097114e-08
    ## UGT1A10     2247.308320       2.587869 0.7063299  3.663825 2.484769e-04 3.585736e-02
    ## NEU4          15.067855       6.046746 1.6319306  3.705271 2.111647e-04 3.247769e-02
    ## SSUH2         29.276238       7.977447 2.2426730  3.557115 3.749494e-04 4.980435e-02
    ## COL6A4P1      17.036188       5.373489 1.3942885  3.853929 1.162373e-04 2.173916e-02
    ## SATB1-AS1     34.333699      22.458034 2.9571613  7.594457 3.090863e-14 9.032275e-11
    ## CELSR3      3149.852296       3.330762 0.7703917  4.323465 1.535975e-05 5.204061e-03
    ## ROPN1         14.317502      -2.339299 0.5928900 -3.945587 7.960482e-05 1.696886e-02
    ## MUC13      10668.717363       4.168265 0.8607882  4.842381 1.282925e-06 7.315177e-04
    ## ALG1L        141.183511       6.197985 1.5455967  4.010092 6.069499e-05 1.418927e-02
    ## AC144530.1   221.960285      -1.796795 0.4833665 -3.717253 2.014009e-04 3.169030e-02
    ## ABLIM2       301.072332       2.802057 0.6311709  4.439458 9.018588e-06 3.764938e-03
    ## KCTD8         20.742465      -4.300641 0.9388225 -4.580888 4.630048e-06 2.122378e-03
    ## NPNT         824.300904       4.150964 1.1306000  3.671470 2.411590e-04 3.501749e-02
    ## AC093817.2    23.062296      21.909155 2.8822453  7.601419 2.929004e-14 9.032275e-11
    ## SMIM31       224.819913       3.716234 0.7797815  4.765738 1.881638e-06 9.359349e-04
    ## SLC6A19      927.151878       4.217032 1.0380930  4.062287 4.859418e-05 1.183370e-02
    ## AC116345.4    17.691118       7.251253 1.9381274  3.741371 1.830193e-04 2.950776e-02
    ## AC022101.1    20.582757      21.737749 3.1326289  6.939140 3.944953e-12 5.764069e-09
    ## AC010378.2   118.845278       9.998328 2.2939634  4.358539 1.309337e-05 4.680560e-03
    ## PCDHB7        11.614499      20.947909 3.1333657  6.685434 2.302415e-11 2.691293e-08
    ## PCDHB9       209.291480       9.385837 1.9101890  4.913565 8.943527e-07 5.807827e-04
    ## PCDHB10      120.424713       6.138689 1.4959566  4.103521 4.069098e-05 1.051231e-02
    ## PCDHB14      150.637698       3.472540 0.8755445  3.966149 7.304336e-05 1.595895e-02
    ## BTNL9        812.920357       2.433599 0.5580869  4.360609 1.297007e-05 4.680560e-03
    ## AL023583.1     4.148070       5.144877 1.3648471  3.769563 1.635334e-04 2.752696e-02
    ## LINC02535     30.938153       4.271636 1.0997982  3.884018 1.027445e-04 1.952813e-02
    ## CCN6         218.659033       6.310216 1.4063306  4.487007 7.223055e-06 3.070192e-03
    ## LINC00326     14.364091      -4.412504 0.7652000 -5.766471 8.094843e-09 7.569650e-06
    ## MYB         1039.042225       2.329716 0.6268526  3.716529 2.019786e-04 3.169030e-02
    ## HECA        1637.404715       1.160498 0.3078769  3.769357 1.636687e-04 2.752696e-02
    ## THBS2       3149.783475      10.803262 2.5572328  4.224591 2.393754e-05 7.562323e-03
    ## DLL1         249.830155       3.326780 0.8336897  3.990430 6.595367e-05 1.482562e-02
    ## ZFAND2A      780.188826       1.154711 0.2501679  4.615743 3.916914e-06 1.831392e-03
    ## AC005550.2    17.625121      21.534476 2.9348624  7.337474 2.176628e-13 4.625927e-10
    ## HOXA9         56.219062      21.525746 2.9822845  7.217871 5.280764e-13 9.658289e-10
    ## HOXA10       553.400299       8.167291 2.1364861  3.822768 1.319620e-04 2.373082e-02
    ## HOXA11       187.315686      24.826414 3.1156835  7.968208 1.609918e-15 9.409164e-12
    ## HOXA11-AS    142.729092      24.449168 3.0623833  7.983706 1.420039e-15 9.409164e-12
    ## HOXA13       737.422512      11.791676 2.6912745  4.381447 1.178937e-05 4.593533e-03
    ## MLXIPL      3638.209402       2.846164 0.6947431  4.096715 4.190551e-05 1.063114e-02
    ## ABHD11-AS1   193.703134       3.702922 0.9020265  4.105114 4.041156e-05 1.051231e-02
    ## CLDN3       7965.929920       4.028233 0.8421413  4.783322 1.724212e-06 8.957471e-04
    ## ADAM22       279.556535       2.111203 0.5590904  3.776138 1.592788e-04 2.717970e-02
    ## FEZF1        284.923654       8.861948 2.0452742  4.332890 1.471647e-05 5.059437e-03
    ## FEZF1-AS1    474.044720       8.948615 1.7748662  5.041853 4.610450e-07 3.079517e-04
    ## AC087269.1    10.738978      20.838608 3.1335033  6.650259 2.925779e-11 3.257088e-08
    ## SLC10A5      154.894995       2.202601 0.5867777  3.753722 1.742281e-04 2.868383e-02
    ## CA1            9.814069       4.559309 1.2296996  3.707661 2.091825e-04 3.247181e-02
    ## CDH17        242.826690       6.136673 1.7039497  3.601440 3.164594e-04 4.301271e-02
    ## OSR2         214.109312       7.588146 1.4091873  5.384767 7.253844e-08 5.652679e-05
    ## NCALD        140.421820       3.674914 1.0116376  3.632639 2.805378e-04 3.974796e-02
    ## FBXO32       224.437333       1.601139 0.4076043  3.928171 8.559419e-05 1.725018e-02
    ## AC105219.1    69.769851       2.061796 0.5157705  3.997507 6.401302e-05 1.467153e-02
    ## MAPK15       532.876778       3.908711 0.9415931  4.151168 3.307827e-05 9.666297e-03
    ## LMX1B         97.172255       4.502791 1.1794695  3.817640 1.347341e-04 2.380349e-02
    ## NOTCH1      3795.734482       2.411081 0.6629745  3.636762 2.760865e-04 3.935579e-02
    ## TUBAL3        65.823694       6.731083 1.6031201  4.198739 2.684051e-05 8.044582e-03
    ## AL132657.1     9.087446       2.492234 0.5359230  4.650358 3.313591e-06 1.613857e-03
    ## LINC02672      9.148759      20.524229 3.1338210  6.549267 5.782029e-11 5.877055e-08
    ## AC010789.1    89.950310       9.114466 2.1574727  4.224603 2.393622e-05 7.562323e-03
    ## CLRN3        591.939249       9.801258 1.7816402  5.501256 3.770961e-08 3.039914e-05
    ## PTPRE        766.342927       2.490034 0.6026446  4.131845 3.598637e-05 1.001535e-02
    ## PRAP1        158.302180       5.529675 1.5236867  3.629142 2.843652e-04 4.004753e-02
    ## CDHR5       2114.460937       3.905971 0.9601841  4.067940 4.743061e-05 1.167192e-02
    ## MUC2         797.507737       5.341246 1.3074780  4.085152 4.404806e-05 1.095485e-02
    ## H19         5206.734782       8.390141 1.9258765  4.356531 1.321400e-05 4.680560e-03
    ## ASCL2       2006.440882       4.153532 1.0969170  3.786551 1.527529e-04 2.645228e-02
    ## RTN4RL2       99.941706       2.978915 0.7247582  4.110219 3.952842e-05 1.051231e-02
    ## HOTAIR       153.324697      22.697062 2.3532614  9.644939 5.164207e-22 6.036441e-18
    ## HOXC11       390.135402      25.853044 2.4161266 10.700202 1.015564e-26 2.374185e-22
    ## HOXC10       354.654410      10.613398 2.0384269  5.206661 1.922685e-07 1.404641e-04
    ## HOXC9        196.694436       8.177578 1.9721463  4.146537 3.375413e-05 9.742026e-03
    ## HOXC-AS1      21.650494       7.056197 1.8026801  3.914281 9.067394e-05 1.781324e-02
    ## HOXC8         13.886492       5.928041 1.5127552  3.918705 8.902612e-05 1.763773e-02
    ## AC012531.1    25.999424       7.807049 1.6302376  4.788903 1.676957e-06 8.909980e-04
    ## SLC39A5      113.644879       3.821502 1.0328188  3.700070 2.155396e-04 3.283016e-02
    ## MYO1A       1077.004527       5.841597 1.1584966  5.042394 4.597425e-07 3.079517e-04
    ## AC121761.1    36.650366       2.621021 0.6236612  4.202636 2.638242e-05 8.009977e-03
    ## SYT1         104.029801       7.247669 1.8627011  3.890946 9.985418e-05 1.916782e-02
    ## AC124947.2    52.390419       2.741327 0.6789255  4.037744 5.396775e-05 1.274402e-02
    ## N4BP2L1      289.343135       1.482474 0.4153640  3.569095 3.582163e-04 4.785360e-02
    ## SPERT         29.530875      22.249526 3.1323397  7.103165 1.219316e-12 2.036083e-09
    ## AKAP6        105.239998       1.560737 0.4168642  3.743994 1.811182e-04 2.940404e-02
    ## BDKRB2        76.110703       6.132793 1.3916080  4.406983 1.048204e-05 4.299109e-03
    ## PHGR1         92.095495       9.834854 2.5032946  3.928764 8.538355e-05 1.725018e-02
    ## PPP1R14D     165.688365       3.820759 1.0257784  3.724741 1.955159e-04 3.109368e-02
    ## DLL4         103.657719       3.726853 0.9484506  3.929411 8.515406e-05 1.725018e-02
    ## STRCP1        39.987289       1.290458 0.3535375  3.650130 2.621076e-04 3.759235e-02
    ## GLDN          71.460754       3.825708 0.9209332  4.154165 3.264780e-05 9.661270e-03
    ## WDR72        776.533494       5.221611 1.1941441  4.372681 1.227301e-05 4.680560e-03
    ## CYP1A1      1411.161536       5.743133 1.0338810  5.554927 2.777284e-08 2.318834e-05
    ## ISL2          37.225357       6.835569 1.6517114  4.138477 3.496192e-05 9.967559e-03
    ## WDR93         19.970063       5.606015 1.4191479  3.950269 7.806353e-05 1.689786e-02
    ## CCDC78       194.759733       1.556977 0.4200112  3.706990 2.097375e-04 3.247181e-02
    ## ANKS4B       589.004543       5.431274 1.3782621  3.940668 8.125489e-05 1.696886e-02
    ## ALDOA        302.516609      -1.432793 0.3096528 -4.627096 3.708289e-06 1.769232e-03
    ## CHST5        411.646294       5.816963 1.2069665  4.819490 1.439258e-06 8.011186e-04
    ## HSD17B2      754.439351       5.362043 1.1056506  4.849672 1.236658e-06 7.315177e-04
    ## YBX2         210.874392       6.041901 1.2583217  4.801555 1.574386e-06 8.559532e-04
    ## CCL14         21.710474       7.061419 1.8694071  3.777358 1.585010e-04 2.717970e-02
    ## CCL15        105.452782       5.879368 1.5112029  3.890522 1.000288e-04 1.916782e-02
    ## SRCIN1       751.654050       2.853603 0.7589469  3.759950 1.699471e-04 2.823771e-02
    ## KRT20        115.752689       4.945187 1.3786185  3.587060 3.344273e-04 4.493242e-02
    ## KRT13        200.529326      -3.191513 0.6679946 -4.777752 1.772656e-06 9.008947e-04
    ## HOXB5        222.586663       7.016579 1.4353628  4.888366 1.016763e-06 6.424293e-04
    ## HOXB6        228.643622       5.087953 1.3572913  3.748608 1.778188e-04 2.907027e-02
    ## AC103702.2   175.840295      24.740706 3.1317861  7.899871 2.791918e-15 1.305389e-11
    ## HOXB13       367.376322       9.273207 2.0286922  4.571027 4.853394e-06 2.181974e-03
    ## ANKRD40CL     89.879717       5.296762 1.4318601  3.699218 2.162651e-04 3.283016e-02
    ## HLF           94.346449       2.989284 0.7300571  4.094589 4.229173e-05 1.063114e-02
    ## EPX           11.154287       1.920323 0.4933302  3.892570 9.918770e-05 1.916782e-02
    ## UNC13D       857.271665      -2.515657 0.5190925 -4.846260 1.258109e-06 7.315177e-04
    ## ONECUT2     1736.543279       3.389399 0.8518195  3.979011 6.920243e-05 1.540756e-02
    ## EFNA2        270.086126       4.456001 1.1588498  3.845193 1.204575e-04 2.203028e-02
    ## AMH          337.974656       3.616017 0.8810897  4.104028 4.060183e-05 1.051231e-02
    ## SHD          166.136267       9.069663 2.1127565  4.292810 1.764258e-05 5.809129e-03
    ## ZNF266      1967.242612       1.204017 0.2472836  4.868973 1.121798e-06 6.901419e-04
    ## OLFM2        627.822097       4.801649 1.1683191  4.109878 3.958688e-05 1.051231e-02
    ## COL5A3       258.855428       6.226602 1.4188605  4.388453 1.141599e-05 4.523442e-03
    ## C3P1          37.893741      22.600564 3.1321929  7.215572 5.370766e-13 9.658289e-10
    ## ADGRL1      3753.313597       1.178512 0.2989720  3.941882 8.084484e-05 1.696886e-02
    ## BST2        6043.723305       6.348799 1.1142204  5.697974 1.212396e-08 1.090131e-05
    ## CEBPA        914.683122       4.209012 1.0202573  4.125442 3.700240e-05 1.017696e-02
    ## FFAR2          4.230719       5.182682 1.4045128  3.690021 2.242353e-04 3.360367e-02
    ## CNTD2        117.661502       4.271647 0.9803655  4.357198 1.317380e-05 4.680560e-03
    ## CYP2B6        13.092558      21.116722 3.1331748  6.739720 1.586918e-11 1.952578e-08
    ## NKPD1         57.370084       2.449680 0.6421961  3.814536 1.364389e-04 2.380349e-02
    ## SULT2A1       30.582901      20.710527 3.1323171  6.611887 3.794512e-11 4.032186e-08
    ## GRIN2D      1311.156428       5.994154 1.0547136  5.683205 1.321936e-08 1.144601e-05
    ## PPFIA3      1130.048543       2.585579 0.6771704  3.818210 1.344233e-04 2.380349e-02
    ## PCK1          52.903492      23.065694 3.1320458  7.364418 1.779216e-13 4.159451e-10
    ## TRPM2        398.182549       8.042450 1.5316683  5.250778 1.514579e-07 1.142188e-04
    ## TRPM2-AS      58.371831       8.972414 2.2562122  3.976760 6.986062e-05 1.540756e-02
    ## TSPEAR-AS2   353.411530       3.917988 1.0830501  3.617550 2.974054e-04 4.109957e-02
    ## TMEM121B      47.533263       2.248769 0.5437942  4.135331 3.544427e-05 9.983327e-03
    ## PRAME        144.537527      24.464402 3.1318103  7.811585 5.647332e-15 2.200389e-11
    ## ISX           20.605612      21.744826 3.1326279  6.941401 3.882304e-12 5.764069e-09
    ## HMOX1        168.279658       2.410397 0.5733607  4.203981 2.622608e-05 8.009977e-03
    ## LGALS2       330.333820       4.125786 1.1225346  3.675420 2.374585e-04 3.491387e-02
    ##  [ reached 'max' / getOption("max.print") -- omitted 7 rows ]

1.  富集分析

通常用的富集分析有ORA、FCS和拓扑三种方法。ORA简单来说就是超几何检验或Fisher精确检验，大同小异，都符合超几何检验，这也是目前用的最多的方法，优劣不谈。FCS的代表就是GSEA，即基因集富集分析，优劣亦不谈。clusterProfiler提供了这两种富集分析方法。

``` r
ox_up <- diff_gene_deseq2_ox %>% 
  dplyr::filter(log2FoldChange>0)
#提取上调基因
ox_gene.df <- bitr(rownames(ox_up), fromType = "SYMBOL",
                toType = c("ENTREZID"),
                OrgDb = org.Hs.eg.db)
#将基因symbol转化为ENTREZID
ox_ENTREZID_list <- ox_gene.df$ENTREZID
#GO富集分析
ox_go <- enrichGO(
  gene = ox_ENTREZID_list, # ENTREZID格式的基因列表，ORA分析不需要对基因进行排序
  keyType ='ENTREZID',
  OrgDb=org.Hs.eg.db,
  ont='BP',#ont代表GO的3大类别，BP, CC, MF，也可是全部ALL
  pAdjustMethod='BH',
  pvalueCutoff = 0.01,
  qvalueCutoff = 0.01,
  readable = TRUE
)
#pAdjustMethod指定多重假设检验矫正的方法，有“ holm”, “hochberg”, “hommel”, “bonferroni”, “BH”, “BY”, “fdr”, “none”中的一种
#readable=TRUE代表将基因ID转换为gene symbol
dotplot(ox_go,showCategory=10,title="Enrichment OX GO Top10")
#气泡图可视化
```

``` r
#KEGG富集分析
ox_kegg <- enrichKEGG(
  gene = ox_ENTREZID_list,
  organism ="hsa",
  pvalueCutoff = 0.05,
  qvalueCutoff = 0.05,
  #readable = TRUE ,
  use_internal_data =FALSE)
ox_kegg <-ox_kegg@result %>% dplyr::filter(pvalue<0.05)
```
